## 核心模块

> 被编译成了二进制文件
>
> 分为两部分：
>
> - c/c++编写的：src目录下
> - JavaScript编写的：lib目录下

#### JavaScript核心模块的编译过程

- 首先将所有的JavaScript代码编译为C/C++代码

1. 转存为C/C++ 代码，转化为C++里的数组

2. 编译JavaScript核心模块

   与文件模块一样，经历了头尾包装的过程，不同的是，核心模块的缓存到NativeModule._cache对象上，文件模块则缓存到Module._cache对象上

### C/C++核心编译过程

分两种：

1.全部有C/C++编写的：

2.由C/C++完成核心部分，其他则由JavaScript实现包装或向外导出：

​	纯C/C++编写的认为为内建模块，不被用户直接调用

​	Node的`buffer，crypto，evals，fs，os`等都是部分通过C/C++编写的

## C/C++模块

JavaScript的一个典型的弱点是位运算，JavaScript中只有double类型，在进行位运算时需要将double型转化为int

## 模块调用栈

C/C++：内建模块

javascript模块：核心模块

文件模块：javascript模块，C/C++扩展模块

## 包与NPM

Node对模块规范的实现，一点程度上解决了变量依赖，依赖关系等代码组织性问题。包的出现则是在模块基础上进一步组织JavaScript代码

CommonJS的包规范：

1. 包结构：组织包中的各个文件

   package.json:包描述文件

   bin：存放可执行的二进制文件

   lib:存放JavaScript的代码的目录

   doc：存放文档

   test：存放单元测试用例的代码

2. 包描述文件：描述包的相关信息

   package.json:位于根目录

   name:包名

   description：包简介

   version：版本号

   keywords：关键词数组

   maintainers：包维护者列表

   contributors：贡献者列表

   bugs：一个可以反馈bug的网页地址或邮件地址

   licenses：当前包使用的许可证列表

   repositories：托管代码的位置列表

   dependencies：使用当前包所依赖的包列表

   可选：

   homepage:当前包网站地址

   os：操作系统列表

   cpu：CPU架构支持列表

   engine：支持JavaScript的引擎列表

   builtin：标志当前包是否是内建在底层系统的标准组件

   directories：包目录说明

   implement：实现规范的列表

   scripts：脚本的说明文档

